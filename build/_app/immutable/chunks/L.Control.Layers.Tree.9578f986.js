(function(l){if(typeof l>"u")throw new Error("Leaflet must be included first");l.Control.Layers.Tree=l.Control.Layers.extend({options:{closedSymbol:"+",openedSymbol:"&minus;",spaceSymbol:" ",selectorBack:!1,namedToggle:!1,collapseAll:"",expandAll:"",labelIsSelector:"both"},_initClassesNames:function(){this.cls={children:"leaflet-layerstree-children",childrenNopad:"leaflet-layerstree-children-nopad",hide:"leaflet-layerstree-hide",closed:"leaflet-layerstree-closed",opened:"leaflet-layerstree-opened",space:"leaflet-layerstree-header-space",pointer:"leaflet-layerstree-header-pointer",header:"leaflet-layerstree-header",neverShow:"leaflet-layerstree-nevershow",node:"leaflet-layerstree-node",name:"leaflet-layerstree-header-name",label:"leaflet-layerstree-header-label",selAllCheckbox:"leaflet-layerstree-sel-all-checkbox"}},initialize:function(e,s,a){this._scrollTop=0,this._initClassesNames(),this._baseTree=null,this._overlaysTree=null,l.Util.setOptions(this,a),l.Control.Layers.prototype.initialize.call(this,null,null,a),this._setTrees(e,s)},setBaseTree:function(e){return this._setTrees(e)},setOverlayTree:function(e){return this._setTrees(void 0,e)},addBaseLayer:function(e,s){throw"addBaseLayer is disabled"},addOverlay:function(e,s){throw"addOverlay is disabled"},removeLayer:function(e){throw"removeLayer is disabled"},collapse:function(){return this._scrollTop=this._sect().scrollTop,l.Control.Layers.prototype.collapse.call(this)},expand:function(){l.Control.Layers.prototype.expand.call(this),this._sect().scrollTop=this._scrollTop},onAdd:function(e){function s(h){h._layersTreeName&&(r.innerHTML=h._layersTreeName)}var a=l.Control.Layers.prototype.onAdd.call(this,e);if(this.options.namedToggle){var r=this._container.getElementsByClassName("leaflet-control-layers-toggle")[0];l.DomUtil.addClass(r,"leaflet-layerstree-named-toggle"),e.eachLayer(function(h){s(h)}),e.on("baselayerchange",function(h){s(h.layer)},this)}return a},expandTree:function(e){var s=e?this._overlaysList:this._baseLayersList;return s&&this._applyOnTree(s,!1),this._localExpand()},collapseTree:function(e){var s=e?this._overlaysList:this._baseLayersList;return s&&this._applyOnTree(s,!0),this._localExpand()},expandSelected:function(e){function s(n){var f=n.parentElement;if(f){if(l.DomUtil.hasClass(f,a.cls.children)&&!l.DomUtil.hasClass(n,a.cls.childrenNopad)&&l.DomUtil.removeClass(f,h),l.DomUtil.hasClass(f,a.cls.node)){var u=f.getElementsByClassName(a.cls.header)[0];a._applyOnTree(u,!1)}s(f)}}var a=this,r=e?this._overlaysList:this._baseLayersList;if(!r)return this;for(var h=this.cls.hide,t=this._layerControlInputs||r.getElementsByTagName("input"),o=0;o<t.length;o++){var d=t[o];this._getLayer&&!!this._getLayer(d.layerId).overlay!=!!e||d.checked&&s(d.parentElement.parentElement.parentElement.parentElement)}return this._localExpand()},_sect:function(){return this._section||this._form},_setTrees:function(e,s){var a=0;function r(n,f,u){return n&&n.layer&&(u||(n.layer._layersTreeName=n.name||n.label),f[a++]=n.layer),n&&n.children&&n.children.length&&n.children.forEach(function(x){r(x,f,u)}),f}function h(n){return Array.isArray(n)?{noShow:!0,children:n}:n}this._layerControlInputs&&(this._layerControlInputs=[]);for(var t=0;t<this._layers.length;++t)this._layers[t].layer.off("add remove",this._onLayerChange,this);this._layers=[],e!==void 0&&(this._baseTree=h(e)),s!==void 0&&(this._overlaysTree=h(s));var o=r(this._baseTree,{});for(var t in o)this._addLayer(o[t],t);var d=r(this._overlaysTree,{},!0);for(t in d)this._addLayer(d[t],t,!0);return this._map?this._update():this},_localExpand:function(){if(this._map&&l.DomUtil.hasClass(this._container,"leaflet-control-layers-expanded")){var e=this._sect().scrollTop;this.expand(),this._sect().scrollTop=e,this._scrollTop=e}return this},_applyOnTree:function(e,s){var a=[{cls:this.cls.children,hide:s},{cls:this.cls.opened,hide:s},{cls:this.cls.closed,hide:!s}];a.forEach(function(r){for(var h=e.getElementsByClassName(r.cls),t=0;t<h.length;t++){var o=h[t];l.DomUtil.hasClass(o,this.cls.childrenNopad)||(r.hide?l.DomUtil.addClass(o,this.cls.hide):l.DomUtil.removeClass(o,this.cls.hide))}},this)},_addItem:function(e){},_update:function(){return this._container?(l.Control.Layers.prototype._update.call(this),this._addTreeLayout(this._baseTree,!1),this._addTreeLayout(this._overlaysTree,!0),this._localExpand()):this},_addTreeLayout:function(e,s){if(e){var a=s?this._overlaysList:this._baseLayersList;this._expandCollapseAll(s,this.options.collapseAll,this.collapseTree),this._expandCollapseAll(s,this.options.expandAll,this.expandTree),this._iterateTreeLayout(e,a,s,[],e.noShow),this._checkDisabledLayers&&this._checkDisabledLayers()}},_expandCollapseAll:function(e,s,a,r){var h=e?this._overlaysList:this._baseLayersList;if(r=r||this,s){var t=document.createElement("div");t.className="leaflet-layerstree-expand-collapse",h.appendChild(t),t.innerHTML=s,t.tabIndex=0,l.DomEvent.on(t,"click keydown",function(o){(o.type!=="keydown"||o.keyCode===32)&&(t.blur(),a.call(r,e),this._localExpand())},this)}},_iterateTreeLayout:function(e,s,a,r,h){if(!e)return;function t(i,c,p,y){var v=l.DomUtil.create(i,c,p);return y&&(v.innerHTML=y),v}var o=t("div",this.cls.header,s),d=t("span"),n=t("span"),f=t("span",this.cls.closed,d,this.options.closedSymbol),u=t("span",this.cls.opened,d,this.options.openedSymbol),x=t("span",this.cls.space,null,this.options.spaceSymbol);this.options.selectorBack?(d.insertBefore(x,f),o.appendChild(n),o.appendChild(d)):(d.appendChild(x),o.appendChild(d),o.appendChild(n));function A(i){var c=i.querySelector("input[type=checkbox]"),p=!0,y=!0,v=i.querySelectorAll("input[type=checkbox]");[].forEach.call(v,function(g){g===c||(g.indeterminate?(p=!1,y=!1):g.checked?y=!1:g.checked||(p=!1))}),p?(c.indeterminate=!1,c.checked=!0):y?(c.indeterminate=!1,c.checked=!1):(c.indeterminate=!0,c.checked=!1)}function N(i,c){r.forEach(function(p){l.DomEvent.on(i,"click",function(y){A(p)},c)},c)}var m;e.selectAllCheckbox&&(m=this._createCheckboxElement(!1),m.className+=" "+this.cls.selAllCheckbox);var _=this.cls.hide;if(e.children){var b=t("div",this.cls.children,s),E=e.layer?d:o;l.DomUtil.addClass(E,this.cls.pointer),E.tabIndex=0,l.DomEvent.on(E,"click keydown",function(i){i.type==="keydown"&&i.keyCode!==32||(E.blur(),l.DomUtil.hasClass(u,_)?(l.DomUtil.addClass(f,_),l.DomUtil.removeClass(u,_),l.DomUtil.removeClass(b,_)):(l.DomUtil.removeClass(f,_),l.DomUtil.addClass(u,_),l.DomUtil.addClass(b,_)),this._localExpand())},this),m&&r.splice(0,0,s),e.children.forEach(function(i){var c=t("div",this.cls.node,b);this._iterateTreeLayout(i,c,a,r)},this),m&&r.splice(0,1)}else l.DomUtil.addClass(d,this.cls.neverShow);var D;e.layer&&(this.options.labelIsSelector==="both"||a&&this.options.labelIsSelector==="overlay"||!a&&this.options.labelIsSelector==="base")?D="label":D="span";var U=t(D,this.cls.label,n);if(e.layer){var w=this._map.hasLayer(e.layer),C,I=a?e.radioGroup:"leaflet-base-layers_"+l.Util.stamp(this);I?C=this._createRadioElement(I,w):(C=this._createCheckboxElement(w),N(C,this)),this._layerControlInputs&&this._layerControlInputs.push(C),C.layerId=l.Util.stamp(e.layer),l.DomEvent.on(C,"click",this._onInputClick,this),U.appendChild(C)}function q(i){return typeof i=="string"||i instanceof String}function j(i){return i&&{}.toString.call(i)==="[object Function]"}function B(i,c){for(var p=s.getElementsByTagName("input"),y=0;y<p.length;y++){var v=p[y];v.type==="checkbox"&&(v.checked=i,v.indeterminate=!1)}c._onInputClick()}e.selectAllCheckbox&&(U.appendChild(m),q(e.selectAllCheckbox)&&(m.title=e.selectAllCheckbox),l.DomEvent.on(m,"click",function(i){i.stopPropagation(),B(m.checked,this)},this),A(s),N(m,this)),t("span",this.cls.name,U,e.label),l.DomUtil.addClass(e.collapsed?u:f,_),e.collapsed&&b&&l.DomUtil.addClass(b,_),h&&(l.DomUtil.addClass(o,this.cls.neverShow),l.DomUtil.addClass(b,this.cls.childrenNopad));var T=e.eventedClasses;T instanceof Array||(T=[T]);for(var S=0;S<T.length;S++){var k=T[S];if(k&&k.className){var O=s.querySelector("."+k.className);O&&l.DomEvent.on(O,k.event||"click",function(i){return function(c){c.stopPropagation();var p=j(i)?i(c,s,e,this._map):i;p!=null&&B(p,this)}}(k.selectAll),this)}}},_createCheckboxElement:function(e){var s=document.createElement("input");return s.type="checkbox",s.className="leaflet-control-layers-selector",s.defaultChecked=e,s}}),l.control.layers.tree=function(e,s,a){return new l.Control.Layers.Tree(e,s,a)}})(L);
