import{s as ft,n as be,o as kt,f as Rt,b as At}from"./scheduler.b108d059.js";import{S as pt,i as vt,g as we,s as $t,h as Te,j as Ne,f as le,c as Ct,y as jt,k as $e,a as yt,x as Ce,r as xt,u as Pt,v as It,d as Dt,t as Lt,w as Ut}from"./index.bb499846.js";import{_ as x}from"./preload-helper.41c905a7.js";function Nt(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in n)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(n,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}var Ft=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{h(r.next(l))}catch(u){o(u)}}function c(l){try{h(r.throw(l))}catch(u){o(u)}}function h(l){l.done?i(l.value):s(l.value).then(a,c)}h((r=r.apply(n,e||[])).next())})};const Mt=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Ft(void 0,void 0,void 0,function*(){return yield(yield x(()=>Promise.resolve().then(()=>Ee),void 0,import.meta.url)).fetch(...t)}):e=fetch,(...t)=>e(...t)};class ze extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class Bt extends ze{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class qt extends ze{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Ht extends ze{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var zt=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{h(r.next(l))}catch(u){o(u)}}function c(l){try{h(r.throw(l))}catch(u){o(u)}}function h(l){l.done?i(l.value):s(l.value).then(a,c)}h((r=r.apply(n,e||[])).next())})};class Jt{constructor(e,{headers:t={},customFetch:r}={}){this.url=e,this.headers=t,this.fetch=Mt(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return zt(this,void 0,void 0,function*(){try{const{headers:s,method:i,body:o}=t;let a={},c;o&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",c=o):typeof o=="string"?(a["Content-Type"]="text/plain",c=o):typeof FormData<"u"&&o instanceof FormData?c=o:(a["Content-Type"]="application/json",c=JSON.stringify(o)));const h=yield this.fetch(`${this.url}/${e}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),s),body:c}).catch(g=>{throw new Bt(g)}),l=h.headers.get("x-relay-error");if(l&&l==="true")throw new qt(h);if(!h.ok)throw new Ht(h);let u=((r=h.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),f;return u==="application/json"?f=yield h.json():u==="application/octet-stream"?f=yield h.blob():u==="multipart/form-data"?f=yield h.formData():f=yield h.text(),{data:f,error:null}}catch(s){return{data:null,error:s}}})}}var Gt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Vt(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Fe={exports:{}};(function(n,e){var t=typeof self<"u"?self:Gt,r=function(){function i(){this.fetch=!1,this.DOMException=t.DOMException}return i.prototype=t,new i}();(function(i){(function(o){var a={searchParams:"URLSearchParams"in i,iterable:"Symbol"in i&&"iterator"in Symbol,blob:"FileReader"in i&&"Blob"in i&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in i,arrayBuffer:"ArrayBuffer"in i};function c(d){return d&&DataView.prototype.isPrototypeOf(d)}if(a.arrayBuffer)var h=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],l=ArrayBuffer.isView||function(d){return d&&h.indexOf(Object.prototype.toString.call(d))>-1};function u(d){if(typeof d!="string"&&(d=String(d)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(d))throw new TypeError("Invalid character in header field name");return d.toLowerCase()}function f(d){return typeof d!="string"&&(d=String(d)),d}function g(d){var p={next:function(){var T=d.shift();return{done:T===void 0,value:T}}};return a.iterable&&(p[Symbol.iterator]=function(){return p}),p}function y(d){this.map={},d instanceof y?d.forEach(function(p,T){this.append(T,p)},this):Array.isArray(d)?d.forEach(function(p){this.append(p[0],p[1])},this):d&&Object.getOwnPropertyNames(d).forEach(function(p){this.append(p,d[p])},this)}y.prototype.append=function(d,p){d=u(d),p=f(p);var T=this.map[d];this.map[d]=T?T+", "+p:p},y.prototype.delete=function(d){delete this.map[u(d)]},y.prototype.get=function(d){return d=u(d),this.has(d)?this.map[d]:null},y.prototype.has=function(d){return this.map.hasOwnProperty(u(d))},y.prototype.set=function(d,p){this.map[u(d)]=f(p)},y.prototype.forEach=function(d,p){for(var T in this.map)this.map.hasOwnProperty(T)&&d.call(p,this.map[T],T,this)},y.prototype.keys=function(){var d=[];return this.forEach(function(p,T){d.push(T)}),g(d)},y.prototype.values=function(){var d=[];return this.forEach(function(p){d.push(p)}),g(d)},y.prototype.entries=function(){var d=[];return this.forEach(function(p,T){d.push([T,p])}),g(d)},a.iterable&&(y.prototype[Symbol.iterator]=y.prototype.entries);function w(d){if(d.bodyUsed)return Promise.reject(new TypeError("Already read"));d.bodyUsed=!0}function E(d){return new Promise(function(p,T){d.onload=function(){p(d.result)},d.onerror=function(){T(d.error)}})}function _(d){var p=new FileReader,T=E(p);return p.readAsArrayBuffer(d),T}function S(d){var p=new FileReader,T=E(p);return p.readAsText(d),T}function v(d){for(var p=new Uint8Array(d),T=new Array(p.length),j=0;j<p.length;j++)T[j]=String.fromCharCode(p[j]);return T.join("")}function b(d){if(d.slice)return d.slice(0);var p=new Uint8Array(d.byteLength);return p.set(new Uint8Array(d)),p.buffer}function H(){return this.bodyUsed=!1,this._initBody=function(d){this._bodyInit=d,d?typeof d=="string"?this._bodyText=d:a.blob&&Blob.prototype.isPrototypeOf(d)?this._bodyBlob=d:a.formData&&FormData.prototype.isPrototypeOf(d)?this._bodyFormData=d:a.searchParams&&URLSearchParams.prototype.isPrototypeOf(d)?this._bodyText=d.toString():a.arrayBuffer&&a.blob&&c(d)?(this._bodyArrayBuffer=b(d.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):a.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(d)||l(d))?this._bodyArrayBuffer=b(d):this._bodyText=d=Object.prototype.toString.call(d):this._bodyText="",this.headers.get("content-type")||(typeof d=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):a.searchParams&&URLSearchParams.prototype.isPrototypeOf(d)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},a.blob&&(this.blob=function(){var d=w(this);if(d)return d;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?w(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(_)}),this.text=function(){var d=w(this);if(d)return d;if(this._bodyBlob)return S(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(v(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},a.formData&&(this.formData=function(){return this.text().then($)}),this.json=function(){return this.text().then(JSON.parse)},this}var Re=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function fe(d){var p=d.toUpperCase();return Re.indexOf(p)>-1?p:d}function U(d,p){p=p||{};var T=p.body;if(d instanceof U){if(d.bodyUsed)throw new TypeError("Already read");this.url=d.url,this.credentials=d.credentials,p.headers||(this.headers=new y(d.headers)),this.method=d.method,this.mode=d.mode,this.signal=d.signal,!T&&d._bodyInit!=null&&(T=d._bodyInit,d.bodyUsed=!0)}else this.url=String(d);if(this.credentials=p.credentials||this.credentials||"same-origin",(p.headers||!this.headers)&&(this.headers=new y(p.headers)),this.method=fe(p.method||this.method||"GET"),this.mode=p.mode||this.mode||null,this.signal=p.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&T)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(T)}U.prototype.clone=function(){return new U(this,{body:this._bodyInit})};function $(d){var p=new FormData;return d.trim().split("&").forEach(function(T){if(T){var j=T.split("="),C=j.shift().replace(/\+/g," "),R=j.join("=").replace(/\+/g," ");p.append(decodeURIComponent(C),decodeURIComponent(R))}}),p}function Ae(d){var p=new y,T=d.replace(/\r?\n[\t ]+/g," ");return T.split(/\r?\n/).forEach(function(j){var C=j.split(":"),R=C.shift().trim();if(R){var B=C.join(":").trim();p.append(R,B)}}),p}H.call(U.prototype);function D(d,p){p||(p={}),this.type="default",this.status=p.status===void 0?200:p.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in p?p.statusText:"OK",this.headers=new y(p.headers),this.url=p.url||"",this._initBody(d)}H.call(D.prototype),D.prototype.clone=function(){return new D(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new y(this.headers),url:this.url})},D.error=function(){var d=new D(null,{status:0,statusText:""});return d.type="error",d};var pe=[301,302,303,307,308];D.redirect=function(d,p){if(pe.indexOf(p)===-1)throw new RangeError("Invalid status code");return new D(null,{status:p,headers:{location:d}})},o.DOMException=i.DOMException;try{new o.DOMException}catch{o.DOMException=function(p,T){this.message=p,this.name=T;var j=Error(p);this.stack=j.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function Q(d,p){return new Promise(function(T,j){var C=new U(d,p);if(C.signal&&C.signal.aborted)return j(new o.DOMException("Aborted","AbortError"));var R=new XMLHttpRequest;function B(){R.abort()}R.onload=function(){var F={status:R.status,statusText:R.statusText,headers:Ae(R.getAllResponseHeaders()||"")};F.url="responseURL"in R?R.responseURL:F.headers.get("X-Request-URL");var ne="response"in R?R.response:R.responseText;T(new D(ne,F))},R.onerror=function(){j(new TypeError("Network request failed"))},R.ontimeout=function(){j(new TypeError("Network request failed"))},R.onabort=function(){j(new o.DOMException("Aborted","AbortError"))},R.open(C.method,C.url,!0),C.credentials==="include"?R.withCredentials=!0:C.credentials==="omit"&&(R.withCredentials=!1),"responseType"in R&&a.blob&&(R.responseType="blob"),C.headers.forEach(function(F,ne){R.setRequestHeader(ne,F)}),C.signal&&(C.signal.addEventListener("abort",B),R.onreadystatechange=function(){R.readyState===4&&C.signal.removeEventListener("abort",B)}),R.send(typeof C._bodyInit>"u"?null:C._bodyInit)})}return Q.polyfill=!0,i.fetch||(i.fetch=Q,i.Headers=y,i.Request=U,i.Response=D),o.Headers=y,o.Request=U,o.Response=D,o.fetch=Q,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(r),r.fetch.ponyfill=!0,delete r.fetch.polyfill;var s=r;e=s.fetch,e.default=s.fetch,e.fetch=s.fetch,e.Headers=s.Headers,e.Request=s.Request,e.Response=s.Response,n.exports=e})(Fe,Fe.exports);var Je=Fe.exports;const Ge=Vt(Je),Ee=Nt({__proto__:null,default:Ge},[Je]);class Kt{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=Ge:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const r=this.fetch;let s=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var o,a,c;let h=null,l=null,u=null,f=i.status,g=i.statusText;if(i.ok){if(this.method!=="HEAD"){const _=await i.text();_===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?l=_:l=JSON.parse(_))}const w=(o=this.headers.Prefer)===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),E=(a=i.headers.get("content-range"))===null||a===void 0?void 0:a.split("/");w&&E&&E.length>1&&(u=parseInt(E[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(l)&&(l.length>1?(h={code:"PGRST116",details:`Results contain ${l.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},l=null,u=null,f=406,g="Not Acceptable"):l.length===1?l=l[0]:l=null)}else{const w=await i.text();try{h=JSON.parse(w),Array.isArray(h)&&i.status===404&&(l=[],h=null,f=200,g="OK")}catch{i.status===404&&w===""?(f=204,g="No Content"):h={message:w}}if(h&&this.isMaybeSingle&&(!((c=h==null?void 0:h.details)===null||c===void 0)&&c.includes("Results contain 0 rows"))&&(h=null,f=200,g="OK"),h&&this.shouldThrowOnError)throw h}return{error:h,data:l,count:u,status:f,statusText:g}});return this.shouldThrowOnError||(s=s.catch(i=>{var o,a,c;return{error:{message:`${(o=i==null?void 0:i.name)!==null&&o!==void 0?o:"FetchError"}: ${i==null?void 0:i.message}`,details:`${(a=i==null?void 0:i.stack)!==null&&a!==void 0?a:""}`,hint:"",code:`${(c=i==null?void 0:i.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),s.then(e,t)}}class Wt extends Kt{select(e){let t=!1;const r=(e??"*").split("").map(s=>/\s/.test(s)&&!t?"":(s==='"'&&(t=!t),s)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:s}={}){const i=s?`${s}.order`:"order",o=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${o?`${o},`:""}${e}.${t?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t}={}){const r=typeof t>"u"?"limit":`${t}.limit`;return this.url.searchParams.set(r,`${e}`),this}range(e,t,{foreignTable:r}={}){const s=typeof r>"u"?"offset":`${r}.offset`,i=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${e}`),this.url.searchParams.set(i,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:s=!1,wal:i=!1,format:o="text"}={}){const a=[e?"analyze":null,t?"verbose":null,r?"settings":null,s?"buffers":null,i?"wal":null].filter(Boolean).join("|"),c=this.headers.Accept;return this.headers.Accept=`application/vnd.pgrst.plan+${o}; for="${c}"; options=${a};`,o==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}class re extends Wt{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=t.map(s=>typeof s=="string"&&new RegExp("[,()]").test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:s}={}){let i="";s==="plain"?i="pl":s==="phrase"?i="ph":s==="websearch"&&(i="w");const o=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${i}fts${o}.${t}`),this}match(e){return Object.entries(e).forEach(([t,r])=>{this.url.searchParams.append(t,`eq.${r}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t}={}){const r=t?`${t}.or`:"or";return this.url.searchParams.append(r,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}}class Zt{constructor(e,{headers:t={},schema:r,fetch:s}){this.url=e,this.headers=t,this.schema=r,this.fetch=s}select(e,{head:t=!1,count:r}={}){const s=t?"HEAD":"GET";let i=!1;const o=(e??"*").split("").map(a=>/\s/.test(a)&&!i?"":(a==='"'&&(i=!i),a)).join("");return this.url.searchParams.set("select",o),r&&(this.headers.Prefer=`count=${r}`),new re({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:r=!0}={}){const s="POST",i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),r||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(e)){const o=e.reduce((a,c)=>a.concat(Object.keys(c)),[]);if(o.length>0){const a=[...new Set(o)].map(c=>`"${c}"`);this.url.searchParams.set("columns",a.join(","))}}return new re({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:s,defaultToNull:i=!0}={}){const o="POST",a=[`resolution=${r?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&a.push(this.headers.Prefer),s&&a.push(`count=${s}`),i||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(e)){const c=e.reduce((h,l)=>h.concat(Object.keys(l)),[]);if(c.length>0){const h=[...new Set(c)].map(l=>`"${l}"`);this.url.searchParams.set("columns",h.join(","))}}return new re({method:o,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const r="PATCH",s=[];return this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),this.headers.Prefer=s.join(","),new re({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",r=[];return e&&r.push(`count=${e}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new re({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}const Xt="1.7.1",Yt={"X-Client-Info":`postgrest-js/${Xt}`};class Qt{constructor(e,{headers:t={},schema:r,fetch:s}={}){this.url=e,this.headers=Object.assign(Object.assign({},Yt),t),this.schema=r,this.fetch=s}from(e){const t=new URL(`${this.url}/${e}`);return new Zt(t,{headers:Object.assign({},this.headers),schema:this.schema,fetch:this.fetch})}rpc(e,t={},{head:r=!1,count:s}={}){let i;const o=new URL(`${this.url}/rpc/${e}`);let a;r?(i="HEAD",Object.entries(t).forEach(([h,l])=>{o.searchParams.append(h,`${l}`)})):(i="POST",a=t);const c=Object.assign({},this.headers);return s&&(c.Prefer=`count=${s}`),new re({method:i,url:o,headers:c,schema:this.schema,body:a,fetch:this.fetch,allowEmpty:!1})}}var je,Ye;function er(){if(Ye)return je;Ye=1;var n=function(){if(typeof self=="object"&&self)return self;if(typeof window=="object"&&window)return window;throw new Error("Unable to resolve global `this`")};return je=function(){if(this)return this;if(typeof globalThis=="object"&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch{return n()}try{return __global__||n()}finally{delete Object.prototype.__global__}}(),je}const tr="websocket",rr="Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",ir=["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],sr="Brian McKelvey <theturtle32@gmail.com> (https://github.com/theturtle32)",nr=["IÃ±aki Baz Castillo <ibc@aliax.net> (http://dev.sipdoc.net)"],or="1.0.34",ar={type:"git",url:"https://github.com/theturtle32/WebSocket-Node.git"},lr="https://github.com/theturtle32/WebSocket-Node",cr={node:">=4.0.0"},hr={bufferutil:"^4.0.1",debug:"^2.2.0","es5-ext":"^0.10.50","typedarray-to-buffer":"^3.1.5","utf-8-validate":"^5.0.2",yaeti:"^0.0.6"},dr={"buffer-equal":"^1.0.0",gulp:"^4.0.2","gulp-jshint":"^2.0.4","jshint-stylish":"^2.2.1",jshint:"^2.0.0",tape:"^4.9.1"},ur={verbose:!1},fr={test:"tape test/unit/*.js",gulp:"gulp"},pr="index",vr={lib:"./lib"},yr="lib/browser.js",_r="Apache-2.0",gr={name:tr,description:rr,keywords:ir,author:sr,contributors:nr,version:or,repository:ar,homepage:lr,engines:cr,dependencies:hr,devDependencies:dr,config:ur,scripts:fr,main:pr,directories:vr,browser:yr,license:_r};var mr=gr.version,W;if(typeof globalThis=="object")W=globalThis;else try{W=er()}catch{}finally{if(!W&&typeof window<"u"&&(W=window),!W)throw new Error("Could not determine global this")}var de=W.WebSocket||W.MozWebSocket,br=mr;function _t(n,e){var t;return e?t=new de(n,e):t=new de(n),t}de&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(n){Object.defineProperty(_t,n,{get:function(){return de[n]}})});var wr={w3cwebsocket:de?_t:null,version:br};const Tr="2.7.3",Sr={"X-Client-Info":`realtime-js/${Tr}`},Er="1.0.0",gt=1e4,Or=1e3;var ce;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(ce||(ce={}));var L;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(L||(L={}));var M;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(M||(M={}));var Me;(function(n){n.websocket="websocket"})(Me||(Me={}));var Z;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(Z||(Z={}));class mt{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}class kr{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const s=t.getUint8(1),i=t.getUint8(2);let o=this.HEADER_LENGTH+2;const a=r.decode(e.slice(o,o+s));o=o+s;const c=r.decode(e.slice(o,o+i));o=o+i;const h=JSON.parse(r.decode(e.slice(o,e.byteLength)));return{ref:null,topic:a,event:c,payload:h}}}class xe{constructor(e,t,r={},s=gt){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null,this.rateLimited=!1}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){if(this._hasReceived("timeout"))return;this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()})==="rate limited"&&(this.rateLimited=!0)}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Qe;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(Qe||(Qe={}));class he{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=he.syncState(this.state,s,i,o),this.pendingDiffs.forEach(c=>{this.state=he.syncDiff(this.state,c,i,o)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=he.syncDiff(this.state,s,i,o),a())}),this.onJoin((s,i,o)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:i,newPresences:o})}),this.onLeave((s,i,o)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,s){const i=this.cloneDeep(e),o=this.transformState(t),a={},c={};return this.map(i,(h,l)=>{o[h]||(c[h]=l)}),this.map(o,(h,l)=>{const u=i[h];if(u){const f=l.map(E=>E.presence_ref),g=u.map(E=>E.presence_ref),y=l.filter(E=>g.indexOf(E.presence_ref)<0),w=u.filter(E=>f.indexOf(E.presence_ref)<0);y.length>0&&(a[h]=y),w.length>0&&(c[h]=w)}else a[h]=l}),this.syncDiff(i,{joins:a,leaves:c},r,s)}static syncDiff(e,t,r,s){const{joins:i,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(i,(a,c)=>{var h;const l=(h=e[a])!==null&&h!==void 0?h:[];if(e[a]=this.cloneDeep(c),l.length>0){const u=e[a].map(g=>g.presence_ref),f=l.filter(g=>u.indexOf(g.presence_ref)<0);e[a].unshift(...f)}r(a,l,c)}),this.map(o,(a,c)=>{let h=e[a];if(!h)return;const l=c.map(u=>u.presence_ref);h=h.filter(u=>l.indexOf(u.presence_ref)<0),e[a]=h,s(a,h,c),h.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const s=e[r];return"metas"in s?t[r]=s.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[r]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var A;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(A||(A={}));const et=(n,e,t={})=>{var r;const s=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((i,o)=>(i[o]=Rr(o,n,e,s),i),{})},Rr=(n,e,t,r)=>{const s=e.find(a=>a.name===n),i=s==null?void 0:s.type,o=t[n];return i&&!r.includes(i)?bt(i,o):Be(o)},bt=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return jr(e,t)}switch(n){case A.bool:return Ar(e);case A.float4:case A.float8:case A.int2:case A.int4:case A.int8:case A.numeric:case A.oid:return $r(e);case A.json:case A.jsonb:return Cr(e);case A.timestamp:return xr(e);case A.abstime:case A.date:case A.daterange:case A.int4range:case A.int8range:case A.money:case A.reltime:case A.text:case A.time:case A.timestamptz:case A.timetz:case A.tsrange:case A.tstzrange:return Be(e);default:return Be(e)}},Be=n=>n,Ar=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},$r=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},Cr=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},jr=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,r=n[t];if(n[0]==="{"&&r==="}"){let i;const o=n.slice(1,t);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(a=>bt(e,a))}return n},xr=n=>typeof n=="string"?n.replace(" ","T"):n;var tt=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{h(r.next(l))}catch(u){o(u)}}function c(l){try{h(r.throw(l))}catch(u){o(u)}}function h(l){l.done?i(l.value):s(l.value).then(a,c)}h((r=r.apply(n,e||[])).next())})},rt;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(rt||(rt={}));var it;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes"})(it||(it={}));var st;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(st||(st={}));class Ve{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=L.closed,this.joinedOnce=!1,this.pushBuffer=[],this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""}},t.config),this.timeout=this.socket.timeout,this.joinPush=new xe(this,M.join,this.params,this.timeout),this.rejoinTimer=new mt(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=L.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=L.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=L.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=L.errored,this.rejoinTimer.scheduleTimeout())}),this._on(M.reply,{},(s,i)=>{this._trigger(this._replyEventName(i),s)}),this.presence=new he(this)}subscribe(e,t=this.timeout){var r,s;if(this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:i,presence:o}}=this.params;this._onError(h=>e&&e("CHANNEL_ERROR",h)),this._onClose(()=>e&&e("CLOSED"));const a={},c={broadcast:i,presence:o,postgres_changes:(s=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(h=>h.filter))!==null&&s!==void 0?s:[]};this.socket.accessToken&&(a.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:c},a)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",({postgres_changes:h})=>{var l;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),h===void 0){e&&e("SUBSCRIBED");return}else{const u=this.bindings.postgres_changes,f=(l=u==null?void 0:u.length)!==null&&l!==void 0?l:0,g=[];for(let y=0;y<f;y++){const w=u[y],{filter:{event:E,schema:_,table:S,filter:v}}=w,b=h&&h[y];if(b&&b.event===E&&b.schema===_&&b.table===S&&b.filter===v)g.push(Object.assign(Object.assign({},w),{id:b.id}));else{this.unsubscribe(),e&&e("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=g,e&&e("SUBSCRIBED");return}}).receive("error",h=>{e&&e("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(h).join(", ")||"error")))}).receive("timeout",()=>{e&&e("TIMED_OUT")})}return this}presenceState(){return this.presence.state}track(e,t={}){return tt(this,void 0,void 0,function*(){return yield this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)})}untrack(e={}){return tt(this,void 0,void 0,function*(){return yield this.send({type:"presence",event:"untrack"},e)})}on(e,t,r){return this._on(e,t,r)}send(e,t={}){return new Promise(r=>{var s,i,o;const a=this._push(e.type,e,t.timeout||this.timeout);a.rateLimited&&r("rate limited"),e.type==="broadcast"&&!(!((o=(i=(s=this.params)===null||s===void 0?void 0:s.config)===null||i===void 0?void 0:i.broadcast)===null||o===void 0)&&o.ack)&&r("ok"),a.receive("ok",()=>r("ok")),a.receive("timeout",()=>r("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=L.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(M.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{const s=new xe(this,M.leave,{},e);s.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),s.send(),this._canPush()||s.trigger("ok",{})})}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new xe(this,e,t,r);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,i;const o=e.toLocaleLowerCase(),{close:a,error:c,leave:h,join:l}=M;if(r&&[a,c,h,l].indexOf(o)>=0&&r!==this._joinRef())return;let f=this._onMessage(o,t,r);if(t&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(g=>{var y,w,E;return((y=g.filter)===null||y===void 0?void 0:y.event)==="*"||((E=(w=g.filter)===null||w===void 0?void 0:w.event)===null||E===void 0?void 0:E.toLocaleLowerCase())===o}).map(g=>g.callback(f,r)):(i=this.bindings[o])===null||i===void 0||i.filter(g=>{var y,w,E,_,S,v;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in g){const b=g.id,H=(y=g.filter)===null||y===void 0?void 0:y.event;return b&&((w=t.ids)===null||w===void 0?void 0:w.includes(b))&&(H==="*"||(H==null?void 0:H.toLocaleLowerCase())===((E=t.data)===null||E===void 0?void 0:E.type.toLocaleLowerCase()))}else{const b=(S=(_=g==null?void 0:g.filter)===null||_===void 0?void 0:_.event)===null||S===void 0?void 0:S.toLocaleLowerCase();return b==="*"||b===((v=t==null?void 0:t.event)===null||v===void 0?void 0:v.toLocaleLowerCase())}else return g.type.toLocaleLowerCase()===o}).map(g=>{if(typeof f=="object"&&"ids"in f){const y=f.data,{schema:w,table:E,commit_timestamp:_,type:S,errors:v}=y;f=Object.assign(Object.assign({},{schema:w,table:E,commit_timestamp:_,eventType:S,new:{},old:{},errors:v}),this._getPayloadRecords(y))}g.callback(f,r)})}_isClosed(){return this.state===L.closed}_isJoined(){return this.state===L.joined}_isJoining(){return this.state===L.joining}_isLeaving(){return this.state===L.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const s=e.toLocaleLowerCase(),i={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(s=>{var i;return!(((i=s.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&Ve.isEqual(s.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(M.close,{},e)}_onError(e){this._on(M.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=L.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=et(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=et(e.columns,e.old_record)),t}}var Pe=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{h(r.next(l))}catch(u){o(u)}}function c(l){try{h(r.throw(l))}catch(u){o(u)}}function h(l){l.done?i(l.value):s(l.value).then(a,c)}h((r=r.apply(n,e||[])).next())})};const Pr=()=>{};class Ir{constructor(e,t){var r;this.accessToken=null,this.channels=[],this.endPoint="",this.headers=Sr,this.params={},this.timeout=gt,this.transport=wr.w3cwebsocket,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=Pr,this.conn=null,this.sendBuffer=[],this.serializer=new kr,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.eventsPerSecondLimitMs=100,this.inThrottle=!1,this.endPoint=`${e}/${Me.websocket}`,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.transport&&(this.transport=t.transport),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const s=(r=t==null?void 0:t.params)===null||r===void 0?void 0:r.eventsPerSecond;s&&(this.eventsPerSecondLimitMs=Math.floor(1e3/s)),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(i,o)=>o(JSON.stringify(i)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new mt(()=>Pe(this,void 0,void 0,function*(){this.disconnect(),this.connect()}),this.reconnectAfterMs)}connect(){this.conn||(this.conn=new this.transport(this._endPointURL(),[],null,this.headers),this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e)))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}removeChannel(e){return Pe(this,void 0,void 0,function*(){const t=yield e.unsubscribe();return this.channels.length===0&&this.disconnect(),t})}removeAllChannels(){return Pe(this,void 0,void 0,function*(){const e=yield Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e})}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case ce.connecting:return Z.Connecting;case ce.open:return Z.Open;case ce.closing:return Z.Closing;default:return Z.Closed}}isConnected(){return this.connectionState()===Z.Open}channel(e,t={config:{}}){this.isConnected()||this.connect();const r=new Ve(`realtime:${e}`,t,this);return this.channels.push(r),r}push(e){const{topic:t,event:r,payload:s,ref:i}=e;let o=()=>{this.encode(e,a=>{var c;(c=this.conn)===null||c===void 0||c.send(a)})};if(this.log("push",`${t} ${r} (${i})`,s),this.isConnected())if(["broadcast","presence","postgres_changes"].includes(r)){if(this._throttle(o)())return"rate limited"}else o();else this.sendBuffer.push(o)}setAuth(e){this.accessToken=e,this.channels.forEach(t=>{e&&t.updateJoinPayload({access_token:e}),t.joinedOnce&&t._isJoined()&&t._push(M.access_token,{access_token:e})})}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Er}))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:r,event:s,payload:i,ref:o}=t;(o&&o===this.pendingHeartbeatRef||s===(i==null?void 0:i.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${r} ${s} ${o&&"("+o+")"||""}`,i),this.channels.filter(a=>a._isMember(r)).forEach(a=>a._trigger(s,i,o)),this.stateChangeCallbacks.message.forEach(a=>a(t))})}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(M.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${r}${s}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(Or,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}_throttle(e,t=this.eventsPerSecondLimitMs){return()=>this.inThrottle?!0:(e(),t>0&&(this.inThrottle=!0,setTimeout(()=>{this.inThrottle=!1},t)),!1)}}class Ke extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function P(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class Dr extends Ke{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class nt extends Ke{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var wt=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{h(r.next(l))}catch(u){o(u)}}function c(l){try{h(r.throw(l))}catch(u){o(u)}}function h(l){l.done?i(l.value):s(l.value).then(a,c)}h((r=r.apply(n,e||[])).next())})};const Tt=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>wt(void 0,void 0,void 0,function*(){return yield(yield x(()=>Promise.resolve().then(()=>Ee),void 0,import.meta.url)).fetch(...t)}):e=fetch,(...t)=>e(...t)},Lr=()=>wt(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield x(()=>Promise.resolve().then(()=>Ee),void 0,import.meta.url)).Response:Response});var ie=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{h(r.next(l))}catch(u){o(u)}}function c(l){try{h(r.throw(l))}catch(u){o(u)}}function h(l){l.done?i(l.value):s(l.value).then(a,c)}h((r=r.apply(n,e||[])).next())})};const Ie=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Ur=(n,e)=>ie(void 0,void 0,void 0,function*(){const t=yield Lr();n instanceof t?n.json().then(r=>{e(new Dr(Ie(r),n.status||500))}).catch(r=>{e(new nt(Ie(r),r))}):e(new nt(Ie(n),n))}),Nr=(n,e,t,r)=>{const s={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),t))};function Oe(n,e,t,r,s,i){return ie(this,void 0,void 0,function*(){return new Promise((o,a)=>{n(t,Nr(e,r,s,i)).then(c=>{if(!c.ok)throw c;return r!=null&&r.noResolveJson?c:c.json()}).then(c=>o(c)).catch(c=>Ur(c,a))})})}function qe(n,e,t,r){return ie(this,void 0,void 0,function*(){return Oe(n,"GET",e,t,r)})}function V(n,e,t,r,s){return ie(this,void 0,void 0,function*(){return Oe(n,"POST",e,r,s,t)})}function Fr(n,e,t,r,s){return ie(this,void 0,void 0,function*(){return Oe(n,"PUT",e,r,s,t)})}function St(n,e,t,r,s){return ie(this,void 0,void 0,function*(){return Oe(n,"DELETE",e,r,s,t)})}var N=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{h(r.next(l))}catch(u){o(u)}}function c(l){try{h(r.throw(l))}catch(u){o(u)}}function h(l){l.done?i(l.value):s(l.value).then(a,c)}h((r=r.apply(n,e||[])).next())})};const Mr={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},ot={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Br{constructor(e,t={},r,s){this.url=e,this.headers=t,this.bucketId=r,this.fetch=Tt(s)}uploadOrUpdate(e,t,r,s){return N(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},ot),s),a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.append("cacheControl",o.cacheControl)):(i=r,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType);const c=this._removeEmptyFolders(t),h=this._getFinalPath(c),l=yield this.fetch(`${this.url}/object/${h}`,Object.assign({method:e,body:i,headers:a},o!=null&&o.duplex?{duplex:o.duplex}:{}));return l.ok?{data:{path:c},error:null}:{data:null,error:yield l.json()}}catch(i){if(P(i))return{data:null,error:i};throw i}})}upload(e,t,r){return N(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,s){return N(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),o=this._getFinalPath(i),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",t);try{let c;const h=Object.assign({upsert:ot.upsert},s),l=Object.assign(Object.assign({},this.headers),{"x-upsert":String(h.upsert)});typeof Blob<"u"&&r instanceof Blob?(c=new FormData,c.append("cacheControl",h.cacheControl),c.append("",r)):typeof FormData<"u"&&r instanceof FormData?(c=r,c.append("cacheControl",h.cacheControl)):(c=r,l["cache-control"]=`max-age=${h.cacheControl}`,l["content-type"]=h.contentType);const u=yield this.fetch(a.toString(),{method:"PUT",body:c,headers:l});return u.ok?{data:{path:i},error:null}:{data:null,error:yield u.json()}}catch(c){if(P(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e){return N(this,void 0,void 0,function*(){try{let t=this._getFinalPath(e);const r=yield V(this.fetch,`${this.url}/object/upload/sign/${t}`,{},{headers:this.headers}),s=new URL(this.url+r.url),i=s.searchParams.get("token");if(!i)throw new Ke("No token returned by API");return{data:{signedUrl:s.toString(),path:e,token:i},error:null}}catch(t){if(P(t))return{data:null,error:t};throw t}})}update(e,t,r){return N(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t){return N(this,void 0,void 0,function*(){try{return{data:yield V(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers}),error:null}}catch(r){if(P(r))return{data:null,error:r};throw r}})}copy(e,t){return N(this,void 0,void 0,function*(){try{return{data:{path:(yield V(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers})).Key},error:null}}catch(r){if(P(r))return{data:null,error:r};throw r}})}createSignedUrl(e,t,r){return N(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),i=yield V(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const o=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(s){if(P(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,r){return N(this,void 0,void 0,function*(){try{const s=yield V(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:s.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(s){if(P(s))return{data:null,error:s};throw s}})}download(e,t){return N(this,void 0,void 0,function*(){const s=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),o=i?`?${i}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield qe(this.fetch,`${this.url}/${s}/${a}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(P(a))return{data:null,error:a};throw a}})}getPublicUrl(e,t){const r=this._getFinalPath(e),s=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&s.push(i);const a=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});c!==""&&s.push(c);let h=s.join("&");return h!==""&&(h=`?${h}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${h}`)}}}remove(e){return N(this,void 0,void 0,function*(){try{return{data:yield St(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(P(t))return{data:null,error:t};throw t}})}list(e,t,r){return N(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},Mr),t),{prefix:e||""});return{data:yield V(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(P(s))return{data:null,error:s};throw s}})}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const qr="2.5.1",Hr={"X-Client-Info":`storage-js/${qr}`};var ee=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{h(r.next(l))}catch(u){o(u)}}function c(l){try{h(r.throw(l))}catch(u){o(u)}}function h(l){l.done?i(l.value):s(l.value).then(a,c)}h((r=r.apply(n,e||[])).next())})};class zr{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},Hr),t),this.fetch=Tt(r)}listBuckets(){return ee(this,void 0,void 0,function*(){try{return{data:yield qe(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(P(e))return{data:null,error:e};throw e}})}getBucket(e){return ee(this,void 0,void 0,function*(){try{return{data:yield qe(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(P(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return ee(this,void 0,void 0,function*(){try{return{data:yield V(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(P(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return ee(this,void 0,void 0,function*(){try{return{data:yield Fr(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(P(r))return{data:null,error:r};throw r}})}emptyBucket(e){return ee(this,void 0,void 0,function*(){try{return{data:yield V(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(P(t))return{data:null,error:t};throw t}})}deleteBucket(e){return ee(this,void 0,void 0,function*(){try{return{data:yield St(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(P(t))return{data:null,error:t};throw t}})}}class Jr extends zr{constructor(e,t={},r){super(e,t,r)}from(e){return new Br(this.url,this.headers,e,this.fetch)}}const Gr="2.26.0",Vr={"X-Client-Info":`supabase-js/${Gr}`};var Kr=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{h(r.next(l))}catch(u){o(u)}}function c(l){try{h(r.throw(l))}catch(u){o(u)}}function h(l){l.done?i(l.value):s(l.value).then(a,c)}h((r=r.apply(n,e||[])).next())})};const Wr=n=>{let e;return n?e=n:typeof fetch>"u"?e=Ge:e=fetch,(...t)=>e(...t)},Zr=()=>typeof Headers>"u"?Je.Headers:Headers,Xr=(n,e,t)=>{const r=Wr(t),s=Zr();return(i,o)=>Kr(void 0,void 0,void 0,function*(){var a;const c=(a=yield e())!==null&&a!==void 0?a:n;let h=new s(o==null?void 0:o.headers);return h.has("apikey")||h.set("apikey",n),h.has("Authorization")||h.set("Authorization",`Bearer ${c}`),r(i,Object.assign(Object.assign({},o),{headers:h}))})};function Yr(n){return n.replace(/\/$/,"")}function Qr(n,e){const{db:t,auth:r,realtime:s,global:i}=n,{db:o,auth:a,realtime:c,global:h}=e;return{db:Object.assign(Object.assign({},o),t),auth:Object.assign(Object.assign({},a),r),realtime:Object.assign(Object.assign({},c),s),global:Object.assign(Object.assign({},h),i)}}var Y=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{h(r.next(l))}catch(u){o(u)}}function c(l){try{h(r.throw(l))}catch(u){o(u)}}function h(l){l.done?i(l.value):s(l.value).then(a,c)}h((r=r.apply(n,e||[])).next())})};function ei(n){return Math.round(Date.now()/1e3)+n}function ti(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const J=()=>typeof document<"u",K={tested:!1,writable:!1},Se=()=>{if(!J())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(K.tested)return K.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),K.tested=!0,K.writable=!0}catch{K.tested=!0,K.writable=!1}return K.writable};function I(n,e){var t;e||(e=((t=window==null?void 0:window.location)===null||t===void 0?void 0:t.href)||""),n=n.replace(/[\[\]]/g,"\\$&");const r=new RegExp("[?&#]"+n+"(=([^&#]*)|&|#|$)"),s=r.exec(e);return s?s[2]?decodeURIComponent(s[2].replace(/\+/g," ")):"":null}const Et=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>Y(void 0,void 0,void 0,function*(){return yield(yield x(()=>Promise.resolve().then(()=>Ee),void 0,import.meta.url)).fetch(...t)}):e=fetch,(...t)=>e(...t)},ri=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",oe=(n,e,t)=>Y(void 0,void 0,void 0,function*(){yield n.setItem(e,JSON.stringify(t))}),ve=(n,e)=>Y(void 0,void 0,void 0,function*(){const t=yield n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}}),De=(n,e)=>Y(void 0,void 0,void 0,function*(){yield n.removeItem(e)});function ii(n){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t="",r,s,i,o,a,c,h,l=0;for(n=n.replace("-","+").replace("_","/");l<n.length;)o=e.indexOf(n.charAt(l++)),a=e.indexOf(n.charAt(l++)),c=e.indexOf(n.charAt(l++)),h=e.indexOf(n.charAt(l++)),r=o<<2|a>>4,s=(a&15)<<4|c>>2,i=(c&3)<<6|h,t=t+String.fromCharCode(r),c!=64&&s!=0&&(t=t+String.fromCharCode(s)),h!=64&&i!=0&&(t=t+String.fromCharCode(i));return t}class ke{constructor(){this.promise=new ke.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}ke.promiseConstructor=Promise;function at(n){const e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,t=n.split(".");if(t.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const r=t[1];return JSON.parse(ii(r))}function si(n){return new Promise(e=>{setTimeout(()=>e(null),n)})}function ni(n,e){return new Promise((r,s)=>{Y(this,void 0,void 0,function*(){for(let i=0;i<1/0;i++)try{const o=yield n(i);if(!e(i,null,o)){r(o);return}}catch(o){if(!e(i,o)){s(o);return}}})})}function oi(n){return("0"+n.toString(16)).substr(-2)}function ye(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let s="";for(let i=0;i<56;i++)s+=t.charAt(Math.floor(Math.random()*r));return s}return crypto.getRandomValues(e),Array.from(e,oi).join("")}function ai(n){return Y(this,void 0,void 0,function*(){const t=new TextEncoder().encode(n),r=yield crypto.subtle.digest("SHA-256",t),s=new Uint8Array(r);return Array.from(s).map(i=>String.fromCharCode(i)).join("")})}function li(n){return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function _e(n){return Y(this,void 0,void 0,function*(){if(typeof crypto>"u")return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const e=yield ai(n);return li(e)})}class We extends Error{constructor(e,t){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t}}function O(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class ci extends We{constructor(e,t){super(e,t),this.name="AuthApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}function hi(n){return O(n)&&n.name==="AuthApiError"}class Ot extends We{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class se extends We{constructor(e,t,r){super(e),this.name=t,this.status=r}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class te extends se{constructor(){super("Auth session missing!","AuthSessionMissingError",400)}}class Le extends se{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500)}}class ge extends se{constructor(e){super(e,"AuthInvalidCredentialsError",400)}}class z extends se{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ue extends se{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class He extends se{constructor(e,t){super(e,"AuthRetryableFetchError",t)}}function lt(n){return O(n)&&n.name==="AuthRetryableFetchError"}var Ze=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{h(r.next(l))}catch(u){o(u)}}function c(l){try{h(r.throw(l))}catch(u){o(u)}}function h(l){l.done?i(l.value):s(l.value).then(a,c)}h((r=r.apply(n,e||[])).next())})},di=globalThis&&globalThis.__rest||function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};const ae=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),ui=[502,503,504];function ct(n){return Ze(this,void 0,void 0,function*(){if(!ri(n))throw new He(ae(n),0);if(ui.includes(n.status))throw new He(ae(n),n.status);let e;try{e=yield n.json()}catch(t){throw new Ot(ae(t),t)}throw new ci(ae(e),n.status||500)})}const fi=(n,e,t,r)=>{const s={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),t))};function k(n,e,t,r){var s;return Ze(this,void 0,void 0,function*(){const i=Object.assign({},r==null?void 0:r.headers);r!=null&&r.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const o=(s=r==null?void 0:r.query)!==null&&s!==void 0?s:{};r!=null&&r.redirectTo&&(o.redirect_to=r.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=yield pi(n,e,t+a,{headers:i,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(c):{data:Object.assign({},c),error:null}})}function pi(n,e,t,r,s,i){return Ze(this,void 0,void 0,function*(){const o=fi(e,r,s,i);let a;try{a=yield n(t,o)}catch(c){throw console.error(c),new He(ae(c),0)}if(a.ok||(yield ct(a)),r!=null&&r.noResolveJson)return a;try{return yield a.json()}catch(c){yield ct(c)}})}function G(n){var e;let t=null;gi(n)&&(t=Object.assign({},n),t.expires_at=ei(n.expires_in));const r=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:r},error:null}}function X(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function vi(n){return{data:n,error:null}}function yi(n){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:i}=n,o=di(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:i},c=Object.assign({},o);return{data:{properties:a,user:c},error:null}}function _i(n){return n}function gi(n){return n.access_token&&n.refresh_token&&n.expires_in}var q=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{h(r.next(l))}catch(u){o(u)}}function c(l){try{h(r.throw(l))}catch(u){o(u)}}function h(l){l.done?i(l.value):s(l.value).then(a,c)}h((r=r.apply(n,e||[])).next())})},mi=globalThis&&globalThis.__rest||function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};class bi{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=Et(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}signOut(e,t="global"){return q(this,void 0,void 0,function*(){try{return yield k(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(O(r))return{data:null,error:r};throw r}})}inviteUserByEmail(e,t={}){return q(this,void 0,void 0,function*(){try{return yield k(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:X})}catch(r){if(O(r))return{data:{user:null},error:r};throw r}})}generateLink(e){return q(this,void 0,void 0,function*(){try{const{options:t}=e,r=mi(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=r==null?void 0:r.newEmail,delete s.newEmail),yield k(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:yi,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(O(t))return{data:{properties:null,user:null},error:t};throw t}})}createUser(e){return q(this,void 0,void 0,function*(){try{return yield k(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:X})}catch(t){if(O(t))return{data:{user:null},error:t};throw t}})}listUsers(e){var t,r,s,i,o,a,c;return q(this,void 0,void 0,function*(){try{const h={nextPage:null,lastPage:0,total:0},l=yield k(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(i=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:_i});if(l.error)throw l.error;const u=yield l.json(),f=(o=l.headers.get("x-total-count"))!==null&&o!==void 0?o:0,g=(c=(a=l.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&c!==void 0?c:[];return g.length>0&&(g.forEach(y=>{const w=parseInt(y.split(";")[0].split("=")[1].substring(0,1)),E=JSON.parse(y.split(";")[1].split("=")[1]);h[`${E}Page`]=w}),h.total=parseInt(f)),{data:Object.assign(Object.assign({},u),h),error:null}}catch(h){if(O(h))return{data:{users:[]},error:h};throw h}})}getUserById(e){return q(this,void 0,void 0,function*(){try{return yield k(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:X})}catch(t){if(O(t))return{data:{user:null},error:t};throw t}})}updateUserById(e,t){return q(this,void 0,void 0,function*(){try{return yield k(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:X})}catch(r){if(O(r))return{data:{user:null},error:r};throw r}})}deleteUser(e,t=!1){return q(this,void 0,void 0,function*(){try{return yield k(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:X})}catch(r){if(O(r))return{data:{user:null},error:r};throw r}})}_listFactors(e){return q(this,void 0,void 0,function*(){try{const{data:t,error:r}=yield k(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:r}}catch(t){if(O(t))return{data:null,error:t};throw t}})}_deleteFactor(e){return q(this,void 0,void 0,function*(){try{return{data:yield k(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(O(t))return{data:null,error:t};throw t}})}}const wi="2.39.0",Ti="http://localhost:9999",Si="supabase.auth.token",Ei={"X-Client-Info":`gotrue-js/${wi}`},ht=10,dt={getItem:n=>Se()?globalThis.localStorage.getItem(n):null,setItem:(n,e)=>{Se()&&globalThis.localStorage.setItem(n,e)},removeItem:n=>{Se()&&globalThis.localStorage.removeItem(n)}};function Oi(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}var m=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{h(r.next(l))}catch(u){o(u)}}function c(l){try{h(r.throw(l))}catch(u){o(u)}}function h(l){l.done?i(l.value):s(l.value).then(a,c)}h((r=r.apply(n,e||[])).next())})};Oi();const ki={url:Ti,storageKey:Si,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Ei,flowType:"implicit",debug:!1},me=30*1e3,ut=3;class ue{constructor(e){var t;this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.broadcastChannel=null,this.instanceID=ue.nextInstanceID,ue.nextInstanceID+=1,this.instanceID>0&&J()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const r=Object.assign(Object.assign({},ki),e);if(this.logDebugMessages=r.debug,this.inMemorySession=null,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.persistSession=r.persistSession,this.storage=r.storage||dt,this.admin=new bi({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=Et(r.fetch),this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession&&this.storage===dt&&!Se()&&console.warn(`No storage option exists to persist the session, which may result in unexpected behavior when using auth.
        If you want to set persistSession to true, please provide a storage option or you may set persistSession to false to disable this warning.`),J()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}(t=this.broadcastChannel)===null||t===void 0||t.addEventListener("message",s=>m(this,void 0,void 0,function*(){this._debug("received broadcast notification from other tab or client",s),yield this._notifyAllSubscribers(s.data.event,s.data.session,!1)}))}this.initialize()}_debug(...e){return this.logDebugMessages&&console.log(`GoTrueClient@${this.instanceID} ${new Date().toISOString()}`,...e),this}initialize(){return this.initializePromise||(this.initializePromise=this._initialize()),this.initializePromise}_initialize(){return m(this,void 0,void 0,function*(){if(this.initializePromise)return this.initializePromise;try{const e=J()?yield this._isPKCEFlow():!1;if(this._debug("#_initialize()","begin","is PKCE flow",e),e||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:t,error:r}=yield this._getSessionFromUrl(e);if(r)return this._debug("#_initialize()","error detecting session from URL",r),yield this._removeSession(),{error:r};const{session:s,redirectType:i}=t;return this._debug("#_initialize()","detected session in URL",s,"redirect type",i),yield this._saveSession(s),setTimeout(()=>m(this,void 0,void 0,function*(){i==="recovery"?yield this._notifyAllSubscribers("PASSWORD_RECOVERY",s):yield this._notifyAllSubscribers("SIGNED_IN",s)}),0),{error:null}}return yield this._recoverAndRefresh(),{error:null}}catch(e){return O(e)?{error:e}:{error:new Ot("Unexpected error during initialization",e)}}finally{yield this._handleVisibilityChange(),this._debug("#_initialize()","end")}})}signUp(e){var t,r,s;return m(this,void 0,void 0,function*(){try{yield this._removeSession();let i;if("email"in e){const{email:l,password:u,options:f}=e;let g=null,y=null;if(this.flowType==="pkce"){const w=ye();yield oe(this.storage,`${this.storageKey}-code-verifier`,w),g=yield _e(w),y=w===g?"plain":"s256"}i=yield k(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f==null?void 0:f.emailRedirectTo,body:{email:l,password:u,data:(t=f==null?void 0:f.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken},code_challenge:g,code_challenge_method:y},xform:G})}else if("phone"in e){const{phone:l,password:u,options:f}=e;i=yield k(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:l,password:u,data:(r=f==null?void 0:f.data)!==null&&r!==void 0?r:{},channel:(s=f==null?void 0:f.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}},xform:G})}else throw new ge("You must provide either an email or phone number and a password");const{data:o,error:a}=i;if(a||!o)return{data:{user:null,session:null},error:a};const c=o.session,h=o.user;return o.session&&(yield this._saveSession(o.session),yield this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:h,session:c},error:null}}catch(i){if(O(i))return{data:{user:null,session:null},error:i};throw i}})}signInWithPassword(e){return m(this,void 0,void 0,function*(){try{yield this._removeSession();let t;if("email"in e){const{email:i,password:o,options:a}=e;t=yield k(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:G})}else if("phone"in e){const{phone:i,password:o,options:a}=e;t=yield k(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:G})}else throw new ge("You must provide either an email or phone number and a password");const{data:r,error:s}=t;return s?{data:{user:null,session:null},error:s}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new Le}:(r.session&&(yield this._saveSession(r.session),yield this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:{user:r.user,session:r.session},error:s})}catch(t){if(O(t))return{data:{user:null,session:null},error:t};throw t}})}signInWithOAuth(e){var t,r,s,i;return m(this,void 0,void 0,function*(){return yield this._removeSession(),yield this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})})}exchangeCodeForSession(e){return m(this,void 0,void 0,function*(){const t=yield ve(this.storage,`${this.storageKey}-code-verifier`),{data:r,error:s}=yield k(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:t},xform:G});return yield De(this.storage,`${this.storageKey}-code-verifier`),s?{data:{user:null,session:null},error:s}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new Le}:(r.session&&(yield this._saveSession(r.session),yield this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:r,error:s})})}signInWithIdToken(e){return m(this,void 0,void 0,function*(){yield this._removeSession();try{const{options:t,provider:r,token:s,access_token:i,nonce:o}=e,a=yield k(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:G}),{data:c,error:h}=a;return h?{data:{user:null,session:null},error:h}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new Le}:(c.session&&(yield this._saveSession(c.session),yield this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:h})}catch(t){if(O(t))return{data:{user:null,session:null},error:t};throw t}})}signInWithOtp(e){var t,r,s,i,o;return m(this,void 0,void 0,function*(){try{if(yield this._removeSession(),"email"in e){const{email:a,options:c}=e;let h=null,l=null;if(this.flowType==="pkce"){const f=ye();yield oe(this.storage,`${this.storageKey}-code-verifier`,f),h=yield _e(f),l=f===h?"plain":"s256"}const{error:u}=yield k(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=c==null?void 0:c.data)!==null&&t!==void 0?t:{},create_user:(r=c==null?void 0:c.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:h,code_challenge_method:l},redirectTo:c==null?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:u}}if("phone"in e){const{phone:a,options:c}=e,{data:h,error:l}=yield k(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(s=c==null?void 0:c.data)!==null&&s!==void 0?s:{},create_user:(i=c==null?void 0:c.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(o=c==null?void 0:c.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:h==null?void 0:h.message_id},error:l}}throw new ge("You must provide either an email or phone number.")}catch(a){if(O(a))return{data:{user:null,session:null},error:a};throw a}})}verifyOtp(e){var t,r;return m(this,void 0,void 0,function*(){try{e.type!=="email_change"&&e.type!=="phone_change"&&(yield this._removeSession());const{data:s,error:i}=yield k(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:(t=e.options)===null||t===void 0?void 0:t.captchaToken}}),redirectTo:(r=e.options)===null||r===void 0?void 0:r.redirectTo,xform:G});if(i)throw i;if(!s)throw new Error("An error occurred on token verification.");const o=s.session,a=s.user;return o!=null&&o.access_token&&(yield this._saveSession(o),yield this._notifyAllSubscribers("SIGNED_IN",o)),{data:{user:a,session:o},error:null}}catch(s){if(O(s))return{data:{user:null,session:null},error:s};throw s}})}signInWithSSO(e){var t,r,s;return m(this,void 0,void 0,function*(){try{return yield this._removeSession(),yield k(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0}),headers:this.headers,xform:vi})}catch(i){if(O(i))return{data:null,error:i};throw i}})}reauthenticate(){return m(this,void 0,void 0,function*(){try{const{data:{session:e},error:t}=yield this.getSession();if(t)throw t;if(!e)throw new te;const{error:r}=yield k(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:e.access_token});return{data:{user:null,session:null},error:r}}catch(e){if(O(e))return{data:{user:null,session:null},error:e};throw e}})}resend(e){return m(this,void 0,void 0,function*(){try{yield this._removeSession();const t=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:i}=e,{error:o}=yield k(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:r,type:s,options:i}=e,{data:o,error:a}=yield k(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:a}}throw new ge("You must provide either an email or phone number and a type")}catch(t){if(O(t))return{data:{user:null,session:null},error:t};throw t}})}getSession(){return m(this,void 0,void 0,function*(){yield this.initializePromise,this._debug("#getSession()","begin");try{let e=null;if(this.persistSession){const i=yield ve(this.storage,this.storageKey);this._debug("#getSession()","session from storage",i),i!==null&&(this._isValidSession(i)?e=i:(this._debug("#getSession()","session from storage is not valid"),yield this._removeSession()))}else e=this.inMemorySession,this._debug("#getSession()","session from memory",e);if(!e)return{data:{session:null},error:null};const t=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#getSession()",`session has${t?"":" not"} expired`,"expires_at",e.expires_at),!t)return{data:{session:e},error:null};const{session:r,error:s}=yield this._callRefreshToken(e.refresh_token);return s?{data:{session:null},error:s}:{data:{session:r},error:null}}finally{this._debug("#getSession()","end")}})}getUser(e){var t,r;return m(this,void 0,void 0,function*(){try{if(!e){const{data:s,error:i}=yield this.getSession();if(i)throw i;e=(r=(t=s.session)===null||t===void 0?void 0:t.access_token)!==null&&r!==void 0?r:void 0}return yield k(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:X})}catch(s){if(O(s))return{data:{user:null},error:s};throw s}})}updateUser(e,t={}){return m(this,void 0,void 0,function*(){try{const{data:r,error:s}=yield this.getSession();if(s)throw s;if(!r.session)throw new te;const i=r.session,{data:o,error:a}=yield k(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:e,jwt:i.access_token,xform:X});if(a)throw a;return i.user=o.user,yield this._saveSession(i),yield this._notifyAllSubscribers("USER_UPDATED",i),{data:{user:i.user},error:null}}catch(r){if(O(r))return{data:{user:null},error:r};throw r}})}_decodeJWT(e){return at(e)}setSession(e){return m(this,void 0,void 0,function*(){try{if(!e.access_token||!e.refresh_token)throw new te;const t=Date.now()/1e3;let r=t,s=!0,i=null;const o=at(e.access_token);if(o.exp&&(r=o.exp,s=r<=t),s){const{session:a,error:c}=yield this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!a)return{data:{user:null,session:null},error:null};i=a}else{const{data:a,error:c}=yield this.getUser(e.access_token);if(c)throw c;i={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:r-t,expires_at:r},yield this._saveSession(i),yield this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(O(t))return{data:{session:null,user:null},error:t};throw t}})}refreshSession(e){var t;return m(this,void 0,void 0,function*(){try{if(!e){const{data:i,error:o}=yield this.getSession();if(o)throw o;e=(t=i.session)!==null&&t!==void 0?t:void 0}if(!(e!=null&&e.refresh_token))throw new te;const{session:r,error:s}=yield this._callRefreshToken(e.refresh_token);return s?{data:{user:null,session:null},error:s}:r?{data:{user:r.user,session:r},error:null}:{data:{user:null,session:null},error:null}}catch(r){if(O(r))return{data:{user:null,session:null},error:r};throw r}})}_getSessionFromUrl(e){return m(this,void 0,void 0,function*(){try{if(!J())throw new z("No browser detected.");if(this.flowType==="implicit"&&!this._isImplicitGrantFlow())throw new z("Not a valid implicit grant flow url.");if(this.flowType=="pkce"&&!e)throw new Ue("Not a valid PKCE flow url.");if(e){const E=I("code");if(!E)throw new Ue("No code detected.");const{data:_,error:S}=yield this.exchangeCodeForSession(E);if(S)throw S;if(!_.session)throw new Ue("No session detected.");let v=new URL(window.location.href);return v.searchParams.delete("code"),window.history.replaceState(window.history.state,"",v.toString()),{data:{session:_.session,redirectType:null},error:null}}const t=I("error_description");if(t){const E=I("error_code");if(!E)throw new z("No error_code detected.");const _=I("error");throw _?new z(t,{error:_,code:E}):new z("No error detected.")}const r=I("provider_token"),s=I("provider_refresh_token"),i=I("access_token");if(!i)throw new z("No access_token detected.");const o=I("expires_in");if(!o)throw new z("No expires_in detected.");const a=I("refresh_token");if(!a)throw new z("No refresh_token detected.");const c=I("token_type");if(!c)throw new z("No token_type detected.");const l=Math.round(Date.now()/1e3)+parseInt(o),{data:u,error:f}=yield this.getUser(i);if(f)throw f;const g=u.user,y={provider_token:r,provider_refresh_token:s,access_token:i,expires_in:parseInt(o),expires_at:l,refresh_token:a,token_type:c,user:g},w=I("type");return window.location.hash="",this._debug("#_getSessionFromUrl()","clearing window.location.hash"),{data:{session:y,redirectType:w},error:null}}catch(t){if(O(t))return{data:{session:null,redirectType:null},error:t};throw t}})}_isImplicitGrantFlow(){return J()&&(!!I("access_token")||!!I("error_description"))}_isPKCEFlow(){return m(this,void 0,void 0,function*(){const e=yield ve(this.storage,`${this.storageKey}-code-verifier`);return!!I("code")&&!!e})}signOut({scope:e}={scope:"global"}){var t;return m(this,void 0,void 0,function*(){const{data:r,error:s}=yield this.getSession();if(s)return{error:s};const i=(t=r.session)===null||t===void 0?void 0:t.access_token;if(i){const{error:o}=yield this.admin.signOut(i,e);if(o&&!(hi(o)&&(o.status===404||o.status===401)))return{error:o}}return e!=="others"&&(yield this._removeSession(),yield De(this.storage,`${this.storageKey}-code-verifier`),yield this._notifyAllSubscribers("SIGNED_OUT",null)),{error:null}})}onAuthStateChange(e){const t=ti(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),this._emitInitialSession(t),{data:{subscription:r}}}_emitInitialSession(e){var t,r;return m(this,void 0,void 0,function*(){try{const{data:{session:s},error:i}=yield this.getSession();if(i)throw i;yield(t=this.stateChangeEmitters.get(e))===null||t===void 0?void 0:t.callback("INITIAL_SESSION",s),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(s){yield(r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",null),this._debug("INITIAL_SESSION","callback id",e,"error",s),console.error(s)}})}resetPasswordForEmail(e,t={}){return m(this,void 0,void 0,function*(){let r=null,s=null;if(this.flowType==="pkce"){const i=ye();yield oe(this.storage,`${this.storageKey}-code-verifier`,i),r=yield _e(i),s=i===r?"plain":"s256"}try{return yield k(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(O(i))return{data:null,error:i};throw i}})}_refreshAccessToken(e){return m(this,void 0,void 0,function*(){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return yield ni(s=>m(this,void 0,void 0,function*(){return yield si(s*200),this._debug(t,"refreshing attempt",s),yield k(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:G})}),(s,i,o)=>o&&o.error&&lt(o.error)&&Date.now()+(s+1)*200-r<me)}catch(r){if(this._debug(t,"error",r),O(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}})}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}_handleProviderSignIn(e,t){return m(this,void 0,void 0,function*(){const r=yield this._getUrlForProvider(e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),J()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}})}_recoverAndRefresh(){var e;return m(this,void 0,void 0,function*(){const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=yield ve(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r)){this._debug(t,"session is not valid"),r!==null&&(yield this._removeSession());return}const s=Math.round(Date.now()/1e3),i=((e=r.expires_at)!==null&&e!==void 0?e:1/0)<s+ht;if(this._debug(t,`session has${i?"":" not"} expired with margin of ${ht}s`),i){if(this.autoRefreshToken&&r.refresh_token){const{error:o}=yield this._callRefreshToken(r.refresh_token);o&&(console.error(o),lt(o)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",o),yield this._removeSession()))}}else yield this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(t,"error",r),console.error(r);return}finally{this._debug(t,"end")}})}_callRefreshToken(e){var t,r;return m(this,void 0,void 0,function*(){if(!e)throw new te;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new ke;const{data:i,error:o}=yield this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new te;yield this._saveSession(i.session),yield this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const a={session:i.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(i){if(this._debug(s,"error",i),O(i)){const o={session:null,error:i};return(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(s,"end")}})}_notifyAllSubscribers(e,t,r=!0){return m(this,void 0,void 0,function*(){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(a=>m(this,void 0,void 0,function*(){try{yield a.callback(e,t)}catch(c){i.push(c)}}));if(yield Promise.all(o),i.length>0){for(let a=0;a<i.length;a+=1)console.error(i[a]);throw i[0]}}finally{this._debug(s,"end")}})}_saveSession(e){return m(this,void 0,void 0,function*(){this._debug("#_saveSession()",e),this.persistSession||(this.inMemorySession=e),this.persistSession&&e.expires_at&&(yield this._persistSession(e))})}_persistSession(e){return this._debug("#_persistSession()",e),oe(this.storage,this.storageKey,e)}_removeSession(){return m(this,void 0,void 0,function*(){this._debug("#_removeSession()"),this.persistSession?yield De(this.storage,this.storageKey):this.inMemorySession=null})}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&J()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}_startAutoRefresh(){return m(this,void 0,void 0,function*(){yield this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),me);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),yield this._autoRefreshTokenTick()})}_stopAutoRefresh(){return m(this,void 0,void 0,function*(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)})}startAutoRefresh(){return m(this,void 0,void 0,function*(){this._removeVisibilityChangedCallback(),yield this._startAutoRefresh()})}stopAutoRefresh(){return m(this,void 0,void 0,function*(){this._removeVisibilityChangedCallback(),yield this._stopAutoRefresh()})}_autoRefreshTokenTick(){return m(this,void 0,void 0,function*(){this._debug("#_autoRefreshTokenTick()","begin");try{const e=Date.now();try{const{data:{session:t}}=yield this.getSession();if(!t||!t.refresh_token||!t.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const r=Math.floor((t.expires_at*1e3-e)/me);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts ${me}ms, refresh threshold is ${ut} ticks`),r<=ut&&(yield this._callRefreshToken(t.refresh_token))}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}_handleVisibilityChange(){return m(this,void 0,void 0,function*(){if(this._debug("#_handleVisibilityChange()"),!J()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=()=>m(this,void 0,void 0,function*(){return yield this._onVisibilityChanged(!1)}),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),yield this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}})}_onVisibilityChanged(e){return m(this,void 0,void 0,function*(){this._debug(`#_onVisibilityChanged(${e})`,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(e||(yield this.initializePromise,yield this._recoverAndRefresh(),this._debug("#_onVisibilityChanged()","finished waiting for initialize, _recoverAndRefresh")),this.autoRefreshToken&&this._startAutoRefresh()):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()})}_getUrlForProvider(e,t){return m(this,void 0,void 0,function*(){const r=[`provider=${encodeURIComponent(e)}`];if(t!=null&&t.redirectTo&&r.push(`redirect_to=${encodeURIComponent(t.redirectTo)}`),t!=null&&t.scopes&&r.push(`scopes=${encodeURIComponent(t.scopes)}`),this.flowType==="pkce"){const s=ye();yield oe(this.storage,`${this.storageKey}-code-verifier`,s);const i=yield _e(s),o=s===i?"plain":"s256";this._debug("PKCE","code verifier",`${s.substring(0,5)}...`,"code challenge",i,"method",o);const a=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});r.push(a.toString())}if(t!=null&&t.queryParams){const s=new URLSearchParams(t.queryParams);r.push(s.toString())}return`${this.url}/authorize?${r.join("&")}`})}_unenroll(e){var t;return m(this,void 0,void 0,function*(){try{const{data:r,error:s}=yield this.getSession();return s?{data:null,error:s}:yield k(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(t=r==null?void 0:r.session)===null||t===void 0?void 0:t.access_token})}catch(r){if(O(r))return{data:null,error:r};throw r}})}_enroll(e){var t,r;return m(this,void 0,void 0,function*(){try{const{data:s,error:i}=yield this.getSession();if(i)return{data:null,error:i};const{data:o,error:a}=yield k(this.fetch,"POST",`${this.url}/factors`,{body:{friendly_name:e.friendlyName,factor_type:e.factorType,issuer:e.issuer},headers:this.headers,jwt:(t=s==null?void 0:s.session)===null||t===void 0?void 0:t.access_token});return a?{data:null,error:a}:(!((r=o==null?void 0:o.totp)===null||r===void 0)&&r.qr_code&&(o.totp.qr_code=`data:image/svg+xml;utf-8,${o.totp.qr_code}`),{data:o,error:null})}catch(s){if(O(s))return{data:null,error:s};throw s}})}_verify(e){var t;return m(this,void 0,void 0,function*(){try{const{data:r,error:s}=yield this.getSession();if(s)return{data:null,error:s};const{data:i,error:o}=yield k(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(t=r==null?void 0:r.session)===null||t===void 0?void 0:t.access_token});return o?{data:null,error:o}:(yield this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),yield this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),{data:i,error:o})}catch(r){if(O(r))return{data:null,error:r};throw r}})}_challenge(e){var t;return m(this,void 0,void 0,function*(){try{const{data:r,error:s}=yield this.getSession();return s?{data:null,error:s}:yield k(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{headers:this.headers,jwt:(t=r==null?void 0:r.session)===null||t===void 0?void 0:t.access_token})}catch(r){if(O(r))return{data:null,error:r};throw r}})}_challengeAndVerify(e){return m(this,void 0,void 0,function*(){const{data:t,error:r}=yield this._challenge({factorId:e.factorId});return r?{data:null,error:r}:yield this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})})}_listFactors(){return m(this,void 0,void 0,function*(){const{data:{user:e},error:t}=yield this.getUser();if(t)return{data:null,error:t};const r=(e==null?void 0:e.factors)||[],s=r.filter(i=>i.factor_type==="totp"&&i.status==="verified");return{data:{all:r,totp:s},error:null}})}_getAuthenticatorAssuranceLevel(){var e,t;return m(this,void 0,void 0,function*(){const{data:{session:r},error:s}=yield this.getSession();if(s)return{data:null,error:s};if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const i=this._decodeJWT(r.access_token);let o=null;i.aal&&(o=i.aal);let a=o;((t=(e=r.user.factors)===null||e===void 0?void 0:e.filter(l=>l.status==="verified"))!==null&&t!==void 0?t:[]).length>0&&(a="aal2");const h=i.amr||[];return{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:h},error:null}})}}ue.nextInstanceID=0;class Ri extends ue{constructor(e){super(e)}}var Ai=globalThis&&globalThis.__awaiter||function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(l){try{h(r.next(l))}catch(u){o(u)}}function c(l){try{h(r.throw(l))}catch(u){o(u)}}function h(l){l.done?i(l.value):s(l.value).then(a,c)}h((r=r.apply(n,e||[])).next())})};const $i={headers:Vr},Ci={schema:"public"},ji={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},xi={};class Pi{constructor(e,t,r){var s,i,o,a,c,h,l,u;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const f=Yr(e);this.realtimeUrl=`${f}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${f}/auth/v1`,this.storageUrl=`${f}/storage/v1`,this.functionsUrl=`${f}/functions/v1`;const g=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,y={db:Ci,realtime:xi,auth:Object.assign(Object.assign({},ji),{storageKey:g}),global:$i},w=Qr(r??{},y);this.storageKey=(i=(s=w.auth)===null||s===void 0?void 0:s.storageKey)!==null&&i!==void 0?i:"",this.headers=(a=(o=w.global)===null||o===void 0?void 0:o.headers)!==null&&a!==void 0?a:{},this.auth=this._initSupabaseAuthClient((c=w.auth)!==null&&c!==void 0?c:{},this.headers,(h=w.global)===null||h===void 0?void 0:h.fetch),this.fetch=Xr(t,this._getAccessToken.bind(this),(l=w.global)===null||l===void 0?void 0:l.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},w.realtime)),this.rest=new Qt(`${f}/rest/v1`,{headers:this.headers,schema:(u=w.db)===null||u===void 0?void 0:u.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new Jt(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Jr(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}rpc(e,t={},r){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Ai(this,void 0,void 0,function*(){const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,storageKey:i,flowType:o},a,c){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Ri({url:this.authUrl,headers:Object.assign(Object.assign({},h),a),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,flowType:o,fetch:c})}_initRealtimeClient(e){return new Ir(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?(this.realtime.setAuth(r??null),this.changedAccessToken=r):e==="SIGNED_OUT"&&(this.realtime.setAuth(this.supabaseKey),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Ii=(n,e,t)=>new Pi(n,e,t),Di="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5ra3p3b3lkYXBwcHB0amNqcXNtIiwicm9sZSI6ImFub24iLCJpYXQiOjE2ODMwNTM3MDIsImV4cCI6MTk5ODYyOTcwMn0.hm94JMq-eHUA4cvvucxx1P5e_IV84ZJuQHNsyZK4re8";function Li(n){let e,t,r,s,i='<span class="svelte-1ql1d1a">Floyd County Water Department</span>';return{c(){e=we("section"),t=we("div"),r=$t(),s=we("div"),s.innerHTML=i,this.h()},l(o){e=Te(o,"SECTION",{class:!0});var a=Ne(e);t=Te(a,"DIV",{class:!0}),Ne(t).forEach(le),r=Ct(a),s=Te(a,"DIV",{class:!0,["data-svelte-h"]:!0}),jt(s)!=="svelte-1cb11vx"&&(s.innerHTML=i),a.forEach(le),this.h()},h(){$e(t,"class","svelte-1ql1d1a"),$e(s,"class","header-bg svelte-1ql1d1a"),$e(e,"class","svelte-1ql1d1a")},m(o,a){yt(o,e,a),Ce(e,t),n[1](t),Ce(e,r),Ce(e,s)},p:be,i:be,o:be,d(o){o&&le(e),n[1](null)}}}const Ui="https://nkkzwoydapppptjcjqsm.supabase.co";function Ni(n,e,t){const s=Ii(Ui,Di);let i;kt(async()=>{{let g=function(_){window.innerWidth<900?(_.setMaxBounds([[33.810772,-85.775532],[34.765142,-84.741472]]),_.setView([34.330395361608595,-85.2480697631836],10)):(_.setMaxBounds([[34.978092874,-84.6065642812],[33.6857261568,-85.8973345757]]),_.setView([34.330395361608595,-85.2480697631836],11))};const f=await x(()=>import("./leaflet-src.56b1ee1a.js").then(_=>_.l),[],import.meta.url);await x(()=>import("./L.Control.Locate.4e66ab60.js").then(_=>_.L),["./L.Control.Locate.4e66ab60.js","./leaflet-src.56b1ee1a.js"],import.meta.url),await x(()=>import("./L.Control.Layers.Tree.9578f986.js"),[],import.meta.url),await x(()=>Promise.resolve({}),["../assets/L.Control.Layers.Tree.87139324.css"],import.meta.url),await x(()=>import("./leaflet-search.min.3379decf.js").then(_=>_.l),["./leaflet-search.min.3379decf.js","./leaflet-src.56b1ee1a.js"],import.meta.url),await x(()=>Promise.resolve({}),["../assets/leaflet-search.min.55b97090.css"],import.meta.url),await x(()=>import("./L.Icon.Pulse.f09e2562.js"),[],import.meta.url),await x(()=>Promise.resolve({}),["../assets/L.Icon.Pulse.946fd79b.css"],import.meta.url),await x(()=>import("./leaflet.markercluster.c041405c.js").then(_=>_.l),[],import.meta.url),await x(()=>Promise.resolve({}),["../assets/MarkerCluster.Default.490b31c8.css"],import.meta.url),await x(()=>import("https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/Leaflet.fullscreen.min.js"),[],import.meta.url),await x(()=>Promise.resolve({}),["../assets/leaflet.fullscreen.dfd7e4d0.css"],import.meta.url),t(0,i=f.map(i,{zoomControl:!0,maxZoom:18,minZoom:10}).setView([34.330395361608595,-85.2480697631836],0)),g(i),f.control.attribution({prefix:"<span>v 0.0.8</span>",position:"bottomleft"}).addTo(i),i.createPane("pane_OSM");var a=f.tileLayer("http://tile.openstreetmap.org/{z}/{x}/{y}.png",{pane:"pane_OSM",opacity:1,attribution:'<a href="https://www.openstreetmap.org/copyright">Â© OpenStreetMap contributors, CC-BY-SA</a>',minZoom:8,maxZoom:18,minNativeZoom:8,maxNativeZoom:18}).addTo(i);i.createPane("pane_OSM_dark");var c=f.tileLayer("https://server.arcgisonline.com/arcgis/rest/services/Canvas/World_Dark_Gray_Base/MapServer/tile/{z}/{y}/{x}",{className:"map-tiles",pane:"pane_OSM_dark",opacity:1,minZoom:8,maxZoom:16,minNativeZoom:8,maxNativeZoom:16});i.createPane("pane_GoogleSat");var h=f.tileLayer("https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}",{pane:"pane_GoogleSat",opacity:1,attribution:"",minZoom:1,maxZoom:18,minNativeZoom:0,maxNativeZoom:18}),l={label:"Base Maps",children:[{label:"OpenStreetMap",layer:a},{label:"Google Satellite",layer:h},{label:"OpenStreetMap Dark Mode",layer:c}]},u={collapseAll:"",collapsed:!1};i.createPane("pane_FloydBorder"),fetch("https://raw.githubusercontent.com/Main-FCWD/FloydWebMap/main/static/Data/FloydBorder.json").then(_=>_.json()).then(_=>{f.geoJSON(_,{style:{pane:"pane_FloydBorder",opacity:1,color:"rgba(188,35,35,1.0)",dashArray:"",lineCap:"square",lineJoin:"bevel",weight:5,fillOpacity:0,interactive:!1}}).addTo(i)});async function y(){const{data:_,error:S}=await s.from("Meters").select("*,GPS(*)");return S&&console.error("Error fetching meters data:",S),_}async function w(_,S){var v={},b={},H=new window.L.markerClusterGroup,Re=new f.layerGroup;function fe(B){if(B=="Dead Head")return"DarkRed";if(B=="Manual Read")return"DarkGoldenRod";if(B=="Crew Needed")return"Black"}var U,$;for(U=0;U<S.features.length;U++){$=S.features[U];var Ae=$.properties.Route,D=[$.properties.Condition],pe=f.tooltip($.geometry.coordinates,{content:$.properties.Address,permanent:!1,direction:"auto",offset:[10,0]});const B=f.icon({iconUrl:`https://raw.githubusercontent.com/Main-FCWD/FloydWebMap/main/static/Data/markers/rt${Ae}.svg`,iconSize:[25,25]}),F=f.marker($.geometry.coordinates,{icon:B}).bindTooltip(pe).openTooltip();v[$.properties.Route]||(v[$.properties.Route]=window.L.markerClusterGroup()),F._latlng!==null&&F.addTo(v[$.properties.Route]);const ne=f.icon.pulse({color:fe(D),fillColor:fe(D),iconSize:[9,9],animate:!0}),Xe=f.marker($.geometry.coordinates,{icon:ne}).bindTooltip(pe).openTooltip();b[$.properties.Condition]||(b[$.properties.Condition]=f.layerGroup()),Xe.addTo(b[$.properties.Condition]);var Q=`<table><thead><tr><th colspan="2" style="padding-bottom:1em">${$.properties.Address}</th></tr></thead><tbody><tr><td style="text-align: left">Route: </td><td>${$.properties.Route}</td><tr><td style="text-align: left">Account #: </td><td>${$.properties["Account #"]}</td></tr><tr><td style="padding-bottom: 1em; text-align: left">CID #: </td><td style="padding-bottom: 1em">${$.properties["CID #"]}</td></tr><tr><td style="padding-bottom: 1em; text-align: left">Meter #: </td><td style="padding-bottom: 1em">${$.properties["Meter #"]}</td></tr><tr><td style="text-align: left">Condition: </td><td>${$.properties.Condition}</td></tr></tbody><tfoot><tr style="font-size:.75em;padding-top:1em"><td style="text-align:right">Updated: </td><td style="color:Red">${$.properties["Last Read"]}</td></tr></tfoot></table>`;F.bindPopup(Q),Xe.bindPopup(Q),H.addLayer(F),Re.addLayer(F)}console.log("markerCluster: ",$),b["Dead Head"].addTo(_),b["Manual Read"].addTo(_),b["Crew Needed"].addTo(_);var d={label:"Meters",children:[{label:"Routes",children:[{label:"Silver Creek",selectAllCheckbox:!1,collapsed:!0,children:[{label:"Route 10",layer:v[10]},{label:"Route 11",layer:v[11]},{label:"Route 12",layer:v[12]},{label:"Route 13",layer:v[13]},{label:"Route 14",layer:v[14]},{label:"Route 15",layer:v[15]},{label:"Route 16",layer:v[16]},{label:"Route 17",layer:v[17]},{label:"Route 18",layer:v[18]},{label:"Route 19",layer:v[19]},{label:"Route 20",layer:v[20]},{label:"Route 23",layer:v[23]},{label:"Route 24",layer:v[24]},{label:"Route 25",layer:v[25]},{label:"Route 26",layer:v[26]},{label:"Route 27",layer:v[27]},{label:"Route 28",layer:v[28]},{label:"Route 29",layer:v[29]}]},{label:"Lindale",selectAllCheckbox:!1,collapsed:!0,children:[{label:"Route 21",layer:v[21]},{label:"Route 22",layer:v[22]},{label:"Route 30",layer:v[30]},{label:"Route 31",layer:v[31]},{label:"Route 32",layer:v[32]},{label:"Route 33",layer:v[33]}]},{label:"Kingston",selectAllCheckbox:!1,collapsed:!0,children:[{label:"Route 42",layer:v[42]},{label:"Route 43",layer:v[43]},{label:"Route 44",layer:v[44]},{label:"Route 45",layer:v[45]},{label:"Route 46",layer:v[46]},{label:"Route 47",layer:v[47]},{label:"Route 48",layer:v[48]}]},{label:"Shannon",selectAllCheckbox:!1,collapsed:!0,children:[{label:"Route 50",layer:v[50]},{label:"Route 51",layer:v[51]},{label:"Route 52",layer:v[52]},{label:"Route 53",layer:v[53]},{label:"Route 61",layer:v[61]},{label:"Route 62",layer:v[62]}]},{label:"Armuchee",selectAllCheckbox:!1,collapsed:!0,children:[{label:"Route 68",layer:v[68]},{label:"Route 69",layer:v[69]},{label:"Route 70",layer:v[70]},{label:"Route 71",layer:v[71]},{label:"Route 72",layer:v[72]},{label:"Route 73",layer:v[73]},{label:"Route 74",layer:v[74]},{label:"Route 75",layer:v[75]},{label:"Route 77",layer:v[77]},{label:"Route 78",layer:v[78]},{label:"Route 79",layer:v[79]}]},{label:"Coosa",selectAllCheckbox:!1,collapsed:!0,children:[{label:"Route 80",layer:v[80]},{label:"Route 81",layer:v[81]},{label:"Route 82",layer:v[82]},{label:"Route 83",layer:v[83]},{label:"Route 84",layer:v[84]},{label:"Route 85",layer:v[85]},{label:"Route 91",layer:v[91]}]}]},{label:"Problems",selectAllCheckbox:!0,collapsed:!0,children:[{label:"Dead Head",layer:b["Dead Head"]},{label:"Manual Read",layer:b["Manual Read"]},{label:"Crew",layer:b["Crew Needed"]}]}]};f.control.layers.tree(l,d,u).addTo(_);var T=document.querySelector("body > div > main > section > div > div.leaflet-control-container > div.leaflet-top.leaflet-right > div > section"),j='<div><img class="layerControlToggle" style="float:right;" src="https://raw.githubusercontent.com/Main-FCWD/FCWD_WebMap/main/static/Data/images/lct_button.png"></div>';T.insertAdjacentHTML("afterbegin",j);var C=document.querySelector("body > div > main > section > div > div.leaflet-control-container > div.leaflet-top.leaflet-right > div > section > div:nth-child(1)");C.addEventListener("click",()=>{document.querySelector("div.header-bg > span").removeAttribute("leaflet-control-layers-expanded"),document.querySelector("body > div > main > section > div > div.leaflet-control-container > div.leaflet-top.leaflet-right > div").setAttribute("class","leaflet-control-layers leaflet-control-layers-collapsed leaflet-control")});var R=document.querySelector("div.header-bg");R.addEventListener("click",()=>{document.querySelector("body > div > main > section").removeChild(R),console.log("Title Span Clicked!")})}async function E(){try{const b=await y();var _={};_.type="FeatureCollection",_.features=[];var S;for(S=0;S<b.length;S++){var v={type:"Feature",geometry:{type:"Point",coordinates:[b[S].GPS.Latitude,b[S].GPS.Longitude]},properties:{Address:b[S].GPS.Address,Route:b[S].GPS.Route,"Account #":b[S].ACCOUNT_NO,"CID #":b[S].CID_NO,"Meter #":b[S].Meter_no,Service:b[S].Service_Type,Condition:b[S].Condition,"Last Read":b[S].New_Date,Count:b[S].Count,"Min Value":b[S]["MIN VALUE"],Average:b[S].MEAN,Median:b[S].Median,"Max Value":b[S]["MAX VALUE"]}};_.features.push(v)}console.log("GeoJSON Data: ",_),w(i,_)}catch(b){console.error("Error: ",b)}}E(),f.control.locate({icon:"leaflet-control-locate-location-arrow",initialZoomLevel:18}).addTo(i),i.addControl(new f.Control.Fullscreen)}}),Rt(async()=>{i&&(console.log("Unloading Leaflet map."),i.remove())});function o(a){At[a?"unshift":"push"](()=>{i=a,t(0,i)})}return[i,o]}class Fi extends pt{constructor(e){super(),vt(this,e,Ni,Li,ft,{})}}function Mi(n){let e,t,r;return t=new Fi({}),{c(){e=we("main"),xt(t.$$.fragment)},l(s){e=Te(s,"MAIN",{});var i=Ne(e);Pt(t.$$.fragment,i),i.forEach(le)},m(s,i){yt(s,e,i),It(t,e,null),r=!0},p:be,i(s){r||(Dt(t.$$.fragment,s),r=!0)},o(s){Lt(t.$$.fragment,s),r=!1},d(s){s&&le(e),Ut(t)}}}class zi extends pt{constructor(e){super(),vt(this,e,null,Mi,ft,{})}}export{zi as P,Gt as c,Vt as g};
